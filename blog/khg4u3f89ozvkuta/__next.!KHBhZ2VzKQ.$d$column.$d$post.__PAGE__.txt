1:"$Sreact.fragment"
2:I[99897,["/_next/static/chunks/4eaa70fe861e9598.js","/_next/static/chunks/fa1a8f8830b9bf3a.js","/_next/static/chunks/6dd6809ee42e252f.js","/_next/static/chunks/f2b800ca7ae14e96.js","/_next/static/chunks/e121db38c98deeb4.js","/_next/static/chunks/6d971f5a9c16d0c2.js","/_next/static/chunks/b397c2fd2abb1207.js","/_next/static/chunks/11dff99839ab5ba0.js"],"MotionPreset"]
3:I[22016,["/_next/static/chunks/4eaa70fe861e9598.js","/_next/static/chunks/fa1a8f8830b9bf3a.js","/_next/static/chunks/6dd6809ee42e252f.js","/_next/static/chunks/f2b800ca7ae14e96.js","/_next/static/chunks/e121db38c98deeb4.js","/_next/static/chunks/6d971f5a9c16d0c2.js","/_next/static/chunks/b397c2fd2abb1207.js","/_next/static/chunks/11dff99839ab5ba0.js"],""]
4:I[85437,["/_next/static/chunks/4eaa70fe861e9598.js","/_next/static/chunks/fa1a8f8830b9bf3a.js","/_next/static/chunks/6dd6809ee42e252f.js","/_next/static/chunks/f2b800ca7ae14e96.js","/_next/static/chunks/e121db38c98deeb4.js","/_next/static/chunks/6d971f5a9c16d0c2.js","/_next/static/chunks/b397c2fd2abb1207.js","/_next/static/chunks/11dff99839ab5ba0.js"],"Image"]
5:I[48347,["/_next/static/chunks/4eaa70fe861e9598.js","/_next/static/chunks/fa1a8f8830b9bf3a.js","/_next/static/chunks/6dd6809ee42e252f.js","/_next/static/chunks/f2b800ca7ae14e96.js","/_next/static/chunks/e121db38c98deeb4.js","/_next/static/chunks/6d971f5a9c16d0c2.js","/_next/static/chunks/b397c2fd2abb1207.js","/_next/static/chunks/11dff99839ab5ba0.js"],"default"]
6:I[72436,["/_next/static/chunks/4eaa70fe861e9598.js","/_next/static/chunks/fa1a8f8830b9bf3a.js","/_next/static/chunks/6dd6809ee42e252f.js","/_next/static/chunks/f2b800ca7ae14e96.js","/_next/static/chunks/e121db38c98deeb4.js","/_next/static/chunks/6d971f5a9c16d0c2.js","/_next/static/chunks/b397c2fd2abb1207.js","/_next/static/chunks/11dff99839ab5ba0.js"],"Separator"]
d:I[97367,["/_next/static/chunks/ff1a16fafef87110.js","/_next/static/chunks/7340adf74ff47ec0.js"],"OutletBoundary"]
e:"$Sreact.suspense"
7:T2994,<!doctype html><div class="lake-content" typography="classic"><h2 id="ZInLD"><span class="ne-text">响应式变量赋值</span></h2><p id="u0dd506fb" class="ne-p"><span class="ne-text">响应式变量commits首次赋值接口所返回的数据</span></p><p id="ub497ee64" class="ne-p"><img src="https://cdn.nlark.com/yuque/0/2024/png/1484158/1724654176733-c4bf03bc-1cda-44c9-bd2e-a06c0455b152.png" width="690" id="u077bd02b" class="ne-image"></p><p id="u1d2e6444" class="ne-p"><br></p><p id="ue05c8c2f" class="ne-p"><span class="ne-text">进入触发Proxy的set拦截【在createApp的实例化的过程中，就已经将data选项响应化，可以参考之前的文章】</span></p><p id="ua0b47a01" class="ne-p"><img src="https://cdn.nlark.com/yuque/0/2024/png/1484158/1724394084509-5821f367-a7ec-4083-952d-f9946487f725.png" width="1656" id="EBhF6" class="ne-image"></p><p id="uaa02f888" class="ne-p"><span class="ne-text"></span></p><p id="ud9e1c7d6" class="ne-p"><span class="ne-text">最终进入trigger函数</span></p><p id="u84bb2451" class="ne-p"><img src="https://cdn.nlark.com/yuque/0/2024/png/1484158/1724394327576-b64a6b93-64a6-44cd-9213-917e0fcb7182.png" width="1661" id="ubc198d8a" class="ne-image"></p><ul class="ne-ul"><li id="u298edc8a" data-lake-index-type="0"><span class="ne-text">174行：触发副作用</span></li><li id="u9de3109a" data-lake-index-type="0"><span class="ne-text">177行：利用Reflect返回所赋值的内容，具体可查看（</span><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/set" data-href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/set" target="_blank" class="ne-link"><span class="ne-text">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/set</span></a><span class="ne-text">）</span></li></ul><h2 id="u59PG"><span class="ne-text">trigger</span></h2><p id="u6db26817" class="ne-p"><span class="ne-text">进入trigger内部</span></p><p id="u5bebbe2e" class="ne-p"><img src="https://cdn.nlark.com/yuque/0/2024/png/1484158/1724394939956-4ccb1953-3f06-4352-9f31-104e5c849267.png" width="1230" id="u60c1a4a4" class="ne-image"></p><ul class="ne-ul"><li id="uab2f9e33" data-lake-index-type="0"><span class="ne-text">target实际上是选项式中的data</span></li><li id="u97783b7d" data-lake-index-type="0"><strong><span class="ne-text">targetMap是从一开始注册响应化就收集的响应映射表</span></strong></li></ul><h3 id="Pcy42"><span class="ne-text">执行trigger</span></h3><p id="u573fd450" class="ne-p"><img src="https://cdn.nlark.com/yuque/0/2024/png/1484158/1724654451358-19007aae-128d-4dc4-a160-d5e9643c71de.png" width="1589" id="ue0329fe8" class="ne-image"></p><ul class="ne-ul"><li id="ubb3f36a4" data-lake-index-type="0"><code class="ne-code"><span class="ne-text" style="color: var(--md-box-samantha-normal-text-color) !important; font-size: 16px">startBatch()</span></code><span class="ne-text" style="color: var(--md-box-samantha-normal-text-color) !important; font-size: 16px">和</span><code class="ne-code"><span class="ne-text" style="color: var(--md-box-samantha-normal-text-color) !important; font-size: 16px">endBatch()</span></code><span class="ne-text" style="color: var(--md-box-samantha-normal-text-color) !important; font-size: 16px">：</span></li></ul><ul class="ne-list-wrap"><ul ne-level="1" class="ne-ul"><li id="uc720a402" data-lake-index-type="0"><code class="ne-code"><span class="ne-text" style="color: initial; font-size: 14px">startBatch()</span></code><span class="ne-text" style="color: initial; font-size: 16px">用于开启一个批量更新的阶段。在这个阶段中，响应式数据的变化不会立即触发依赖的更新，而是会被收集起来，等到</span><code class="ne-code"><span class="ne-text" style="color: initial; font-size: 14px">endBatch()</span></code><span class="ne-text" style="color: initial; font-size: 16px">被调用后再统一进行处理。这样做的好处是可以避免在短时间内频繁地触发更新，从而提高性能。例如，在一个循环中多次修改响应式数据时，可以使用批量更新来减少不必要的重复更新操作。</span></li></ul></ul><ul class="ne-ul"><li id="u9896a69c" data-lake-index-type="0"><span class="ne-text" style="color: initial; font-size: 16px">__DEV__：开发环境下传入数据信息便于调试</span></li><li id="ue5b0e614" data-lake-index-type="0"><span class="ne-text" style="color: initial; font-size: 16px">dep.trigger()：触发依赖更新</span></li></ul><p id="u28a61200" class="ne-p"><span class="ne-text">trigger下又执行notify</span></p><p id="ue0a473e3" class="ne-p"><span class="ne-text" style="color: initial; font-size: 16px">封装在</span><img src="https://cdn.nlark.com/yuque/0/2024/png/1484158/1724654522704-0d8ab60d-c703-44b0-a40f-73b74855a77e.png" width="587" id="ua57f0646" class="ne-image"></p><h3 id="tNols"><span class="ne-text">notify</span></h3><p id="ud301b71d" class="ne-p"><span class="ne-text">通过遍历订阅链表（subsHead），执行订阅事件，也就是“副作用”，简而言之的理解就是通知订阅者更新</span></p><p id="ub142d2fd" class="ne-p"><img src="https://cdn.nlark.com/yuque/0/2024/png/1484158/1724395543939-5231eb2e-a79e-457d-a68d-d02ed08a559d.png" width="837" id="ud0255935" class="ne-image"></p><ul class="ne-ul"><li id="udb977797" data-lake-index-type="0"><code class="ne-code"><span class="ne-text">link.sub.notify()</span></code></li></ul><ul class="ne-list-wrap"><ul ne-level="1" class="ne-ul"><li id="u9df9804e" data-lake-index-type="0"><strong><span class="ne-text">作用</span></strong><span class="ne-text">：通知每个订阅者执行其副作用。</span></li><li id="u3da83814" data-lake-index-type="0"><strong><span class="ne-text">解释</span></strong><span class="ne-text">：每个订阅者都有一个 </span><code class="ne-code"><span class="ne-text">notify</span></code><span class="ne-text"> 方法，调用它会触发该订阅者的副作用执行。因为是从尾到头通知，所以确保了所有的依赖在批处理内按顺序执行。</span></li></ul></ul><p id="u70883d6e" class="ne-p"><span class="ne-text">当trigger执行完，同时Proxy的set流程也结束。</span></p><p id="u14d6430c" class="ne-p"><span class="ne-text">下一步执行到PublicInstanceProxyHandlers</span></p><h2 id="pZ0kG"><span class="ne-text">PublicInstanceProxyHandlers</span></h2><p id="u092fb73f" class="ne-p"><span class="ne-text">这个是组件实例行为的封装，上述响应式变量赋值完成，然后进入当前的组件实例属性设置</span></p><p id="u3458adca" class="ne-p"><code class="ne-code"><span class="ne-text">set</span></code><span class="ne-text"> 方法用于拦截和处理对组件实例属性的修改操作  </span></p><p id="u8f60a1be" class="ne-p"><img src="https://cdn.nlark.com/yuque/0/2024/png/1484158/1724396098652-00faed94-469d-4b61-9f77-a20ec73049c7.png" width="800" id="u784063f1" class="ne-image"></p><h2 id="s8RBZ"><span class="ne-text">主线程工作结束</span></h2><p id="u42bf9e38" class="ne-p"><img src="https://cdn.nlark.com/yuque/0/2024/png/1484158/1724396266488-fe4d1ae9-870a-4f43-87d8-3fe03c34c37b.png" width="523" id="u15c91d7a" class="ne-image"></p><h2 id="zp4dR"><span class="ne-text">微任务flushJobs</span></h2><p id="u23a81d85" class="ne-p"><span class="ne-text">执行异步的flushJobs</span></p><p id="u929d3f95" class="ne-p"><img src="https://cdn.nlark.com/yuque/0/2024/png/1484158/1724403602240-595eb2a9-013f-4f9c-8192-15bb17223709.png" width="933" id="u62df03f8" class="ne-image"></p><p id="ufd4b2823" class="ne-p"><code class="ne-code"><span class="ne-text">flushJobs</span></code><span class="ne-text"> 是一个用于刷新调度队列的函数，它会执行所有被调度的任务（如组件更新、计算属性的重新计算等）  </span></p><ul class="ne-ul"><li id="udd02e48e" data-lake-index-type="0"><strong><span class="ne-text">调度器调度任务</span></strong><span class="ne-text">：</span></li><li id="ubac44c6c" data-lake-index-type="0"><span class="ne-text">Vue 3 的调度器会负责管理这个调度队列。调度器会尝试合并重复的任务，确保每个任务只执行一次，并且按照一定的顺序（如父组件先于子组件，先更新计算属性再更新渲染函数）进行调度。</span></li><li id="uc9a965da" data-lake-index-type="0"><code class="ne-code"><strong><span class="ne-text">queueFlush</span></strong></code><strong><span class="ne-text"> 触发</span></strong><span class="ne-text">：</span></li><li id="u1571470d" data-lake-index-type="0"><span class="ne-text">当有新的任务被添加到调度队列时，调度器会调用 </span><code class="ne-code"><span class="ne-text">queueFlush</span></code><span class="ne-text"> 函数，将刷新任务安排到下一个微任务（microtask）中执行。</span></li><li id="uebda4fcc" data-lake-index-type="0"><span class="ne-text">这通常是通过 </span><code class="ne-code"><span class="ne-text">Promise.resolve().then(flushJobs)</span></code><span class="ne-text"> 来实现的。</span><code class="ne-code"><span class="ne-text">Promise.resolve().then(...)</span></code><span class="ne-text"> 会创建一个新的微任务，在当前同步任务结束后立即执行。这样做的好处是保证所有的同步任务（如多个响应式数据的 </span><code class="ne-code"><span class="ne-text">set</span></code><span class="ne-text"> 操作）都完成之后，再一次性执行批量更新操作。</span></li><li id="u114b0ad0" data-lake-index-type="0"><strong><span class="ne-text">执行 </span></strong><code class="ne-code"><strong><span class="ne-text">flushJobs</span></strong></code><span class="ne-text">：</span></li><li id="u1e9084d3" data-lake-index-type="0"><span class="ne-text">一旦所有的同步操作完成，事件循环进入到微任务队列，</span><code class="ne-code"><span class="ne-text">flushJobs</span></code><span class="ne-text"> 函数被调用。</span><code class="ne-code"><span class="ne-text">flushJobs</span></code><span class="ne-text"> 会遍历调度队列，并依次执行每个调度任务（如重新渲染组件、重新计算计算属性等）。</span></li><li id="u17a6f212" data-lake-index-type="0"><span class="ne-text">在这个阶段，所有的 </span><code class="ne-code"><span class="ne-text">effect</span></code><span class="ne-text"> 被重新执行，更新视图、计算新的值等等。</span></li></ul></div>0:{"buildId":"ojCF045NjSCdIX953ggig","rsc":["$","$1","c",{"children":[["$","section",null,{"className":"relative","children":["$","$L2",null,{"fade":true,"blur":true,"transition":{"duration":0.5},"delay":0.1,"className":"relative overflow-hidden border-y xl:flex","children":[["$","div",null,{"className":"m-6 w-full flex-1 bg-[radial-gradient(circle_at_center,color-mix(in_oklab,var(--primary)_15%,transparent)_2px,transparent_2px)] bg-size-[18px_18px] max-xl:hidden"}],["$","div",null,{"className":"mx-auto w-full max-w-6xl flex-none space-y-8 px-4 py-8 min-[1158px]:border-x sm:px-6 sm:py-12 lg:px-8","children":[["$","$L2",null,{"fade":true,"blur":true,"slide":{"direction":"down","offset":30},"transition":{"duration":0.4},"children":["$","$L3",null,{"href":"/blog","className":"text-muted-foreground hover:text-foreground inline-flex items-center gap-2 text-sm transition-colors","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-arrow-left h-4 w-4","aria-hidden":"true","children":[["$","path","1l729n",{"d":"m12 19-7-7 7-7"}],["$","path","x3x0zl",{"d":"M19 12H5"}],"$undefined"]}],"返回","技术博客"]}]}],["$","article",null,{"className":"mx-auto max-w-4xl","children":[["$","header",null,{"className":"mb-8 space-y-6","children":[["$","$L2",null,{"fade":true,"blur":true,"slide":{"direction":"up","offset":50},"delay":0.2,"transition":{"duration":0.6},"children":["$","div",null,{"className":"relative aspect-video overflow-hidden rounded-xl","children":["$","$L4",null,{"src":"https://cdn.nlark.com/yuque/0/2024/png/1484158/1724394084509-5821f367-a7ec-4083-952d-f9946487f725.png","alt":"Vue3源码：响应式变量值变化执行流程","fill":true,"className":"object-cover","unoptimized":true}]}]}],["$","$L2",null,{"delay":0.3,"transition":{"duration":0.5},"children":["$","h1",null,{"className":"text-2xl font-bold tracking-tight sm:text-3xl md:text-4xl","children":["$","$L5",null,{"text":"Vue3源码：响应式变量值变化执行流程","delay":30,"animateBy":"words","direction":"bottom"}]}]}],["$","$L2",null,{"fade":true,"blur":true,"slide":{"direction":"down","offset":30},"delay":0.4,"transition":{"duration":0.5},"children":["$","p",null,{"className":"text-muted-foreground text-lg","children":"响应式变量赋值响应式变量commits首次赋值接口所返回的数据进入触发Proxy的set拦截【在createApp的实例化的过程中，就已经将data选项响应化，可以参考之前的文章】最终进入trigger函数174行：触发副作用177行：利用Reflect返回所赋值的内容，具体可查看（https..."}]}],["$","$L2",null,{"fade":true,"blur":true,"slide":{"direction":"down","offset":30},"delay":0.5,"transition":{"duration":0.5},"children":["$","div",null,{"className":"text-muted-foreground flex flex-wrap items-center gap-4 text-sm","children":[["$","div",null,{"className":"flex items-center gap-1","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-calendar h-4 w-4","aria-hidden":"true","children":[["$","path","1cmpym",{"d":"M8 2v4"}],["$","path","4m81vk",{"d":"M16 2v4"}],["$","rect","1hopcy",{"width":"18","height":"18","x":"3","y":"4","rx":"2"}],["$","path","8toen8",{"d":"M3 10h18"}],"$undefined"]}],["$","span",null,{"children":"2024年8月23日"}]]}],["$","div",null,{"className":"flex items-center gap-1","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-clock h-4 w-4","aria-hidden":"true","children":[["$","path","mmk7yg",{"d":"M12 6v6l4 2"}],["$","circle","1mglay",{"cx":"12","cy":"12","r":"10"}],"$undefined"]}],["$","span",null,{"children":"935字"}]]}],false,false,false]}]}],false]}],["$","$L2",null,{"delay":0.6,"fade":true,"blur":true,"transition":{"duration":0.6},"className":"-mx-4 sm:-mx-6 lg:-mx-8","children":["$","$L6",null,{}]}],["$","$L2",null,{"fade":true,"blur":true,"slide":{"direction":"up","offset":50},"delay":0.7,"transition":{"duration":0.6},"children":["$","div",null,{"className":"prose prose-neutral dark:prose-invert mt-8 max-w-none","dangerouslySetInnerHTML":{"__html":"$7"}}]}],"$L8","$L9"]}]]}],"$La"]}]}],["$Lb"],"$Lc"]}],"loading":null,"isPartial":false}
8:["$","$L2",null,{"delay":0.8,"fade":true,"blur":true,"transition":{"duration":0.6},"className":"-mx-4 mt-12 sm:-mx-6 lg:-mx-8","children":["$","$L6",null,{}]}]
9:["$","$L2",null,{"fade":true,"blur":true,"slide":{"direction":"up","offset":30},"delay":0.9,"transition":{"duration":0.5},"children":["$","nav",null,{"className":"mt-8 grid gap-4 md:grid-cols-2","children":[["$","$L3",null,{"href":"/blog/uq766nlmm1cuh7kk","className":"hover:bg-muted group flex flex-col rounded-lg border p-4 transition-colors","children":[["$","span",null,{"className":"text-muted-foreground mb-2 text-sm","children":"上一篇"}],["$","span",null,{"className":"group-hover:text-primary line-clamp-2 font-medium transition-colors","children":"MongoDB开启事务"}]]}],["$","$L3",null,{"href":"/blog/akvtn4dmv31o552n","className":"hover:bg-muted group flex flex-col rounded-lg border p-4 text-right transition-colors md:text-right","children":[["$","span",null,{"className":"text-muted-foreground mb-2 text-sm","children":"下一篇"}],["$","span",null,{"className":"group-hover:text-primary line-clamp-2 font-medium transition-colors","children":"debug三方库"}]]}]]}]}]
a:["$","div",null,{"className":"m-6 w-full flex-1 bg-[radial-gradient(circle_at_center,color-mix(in_oklab,var(--primary)_15%,transparent)_2px,transparent_2px)] bg-size-[18px_18px] max-xl:hidden"}]
b:["$","script","script-0",{"src":"/_next/static/chunks/11dff99839ab5ba0.js","async":true}]
c:["$","$Ld",null,{"children":["$","$e",null,{"name":"Next.MetadataOutlet","children":"$@f"}]}]
f:null
