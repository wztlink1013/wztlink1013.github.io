1:"$Sreact.fragment"
2:I[99897,["/_next/static/chunks/4eaa70fe861e9598.js","/_next/static/chunks/946bdd2e6c9b7c49.js","/_next/static/chunks/6dd6809ee42e252f.js","/_next/static/chunks/f2b800ca7ae14e96.js","/_next/static/chunks/e121db38c98deeb4.js","/_next/static/chunks/0973dd923ca2781d.js","/_next/static/chunks/b397c2fd2abb1207.js","/_next/static/chunks/11dff99839ab5ba0.js"],"MotionPreset"]
3:I[22016,["/_next/static/chunks/4eaa70fe861e9598.js","/_next/static/chunks/946bdd2e6c9b7c49.js","/_next/static/chunks/6dd6809ee42e252f.js","/_next/static/chunks/f2b800ca7ae14e96.js","/_next/static/chunks/e121db38c98deeb4.js","/_next/static/chunks/0973dd923ca2781d.js","/_next/static/chunks/b397c2fd2abb1207.js","/_next/static/chunks/11dff99839ab5ba0.js"],""]
4:I[85437,["/_next/static/chunks/4eaa70fe861e9598.js","/_next/static/chunks/946bdd2e6c9b7c49.js","/_next/static/chunks/6dd6809ee42e252f.js","/_next/static/chunks/f2b800ca7ae14e96.js","/_next/static/chunks/e121db38c98deeb4.js","/_next/static/chunks/0973dd923ca2781d.js","/_next/static/chunks/b397c2fd2abb1207.js","/_next/static/chunks/11dff99839ab5ba0.js"],"Image"]
5:I[48347,["/_next/static/chunks/4eaa70fe861e9598.js","/_next/static/chunks/946bdd2e6c9b7c49.js","/_next/static/chunks/6dd6809ee42e252f.js","/_next/static/chunks/f2b800ca7ae14e96.js","/_next/static/chunks/e121db38c98deeb4.js","/_next/static/chunks/0973dd923ca2781d.js","/_next/static/chunks/b397c2fd2abb1207.js","/_next/static/chunks/11dff99839ab5ba0.js"],"default"]
6:I[72436,["/_next/static/chunks/4eaa70fe861e9598.js","/_next/static/chunks/946bdd2e6c9b7c49.js","/_next/static/chunks/6dd6809ee42e252f.js","/_next/static/chunks/f2b800ca7ae14e96.js","/_next/static/chunks/e121db38c98deeb4.js","/_next/static/chunks/0973dd923ca2781d.js","/_next/static/chunks/b397c2fd2abb1207.js","/_next/static/chunks/11dff99839ab5ba0.js"],"Separator"]
d:I[97367,["/_next/static/chunks/ff1a16fafef87110.js","/_next/static/chunks/7340adf74ff47ec0.js"],"OutletBoundary"]
e:"$Sreact.suspense"
7:T201b,<!doctype html><div class="lake-content" typography="classic"><ul class="ne-ul"><li id="uaacc4032" data-lake-index-type="0"><a href="https://mp.weixin.qq.com/s/1IhpU2QttGEQnHLRfBuKZQ" data-href="https://mp.weixin.qq.com/s/1IhpU2QttGEQnHLRfBuKZQ" class="ne-link"><span class="ne-text">面试官：说说cookie、session、token、jwt是什么，单点登录怎么实现</span></a></li></ul><p id="ud9767e26" class="ne-p"><span class="ne-text">前端双token校验</span></p><p id="u7e2ed131" class="ne-p"><span class="ne-text">单token情况下，前端请求后端接口携带Token校验，但是token失效时间如果设置长了会有安全隐患，设置短了用户需要频繁刷新用户体验不好。</span></p><p id="ua277addd" class="ne-p"><span class="ne-text">解决办法：</span></p><p id="uab8c8ec1" class="ne-p"><span class="ne-text">设置两个Token，也就是登录完接口初次返回的，AccessToken和RefreshToken：AccessToken是用于鉴定用户身份，请求每一个接口都需要携带AccessToken；RefreshToken为刷新前者的接口所携带的token，也就是当AccessToken失效时候，调用接口携带RefreshToken返回新的RefreshToken和新的AccessToken，然后自动将新的AccessToken放到接口中重新请求，整个流程为无感操作，提升用户体验。</span></p><p id="u83fcf6c6" class="ne-p"><span class="ne-text">上述所提到的刷新接口：</span><code class="ne-code"><span class="ne-text">/auth/refresh</span></code><span class="ne-text">，无需经过网关</span></p><pre data-language="javascript" id="moJZw" class="ne-codeblock language-javascript"><code>// token刷新锁
let isRefreshing = false;
// 重试队列
let requests = [],</code></pre><p id="u8dbcc3f3" class="ne-p"><span class="ne-text">在Access_Token过期后，可能会短时间发送很多个网络请求，这些网络请求拦截器全都会请求刷新Token，这样显然是不合理的。其实只要刷新一次就够了，所以给刷新Token这步操作加一个锁，这也就是为什么要设置isRefreshing的原因。</span></p><p id="uc5f622ca" class="ne-p"><span class="ne-text">在请求刷新Token的响应时间内，可能会有多个网络请求到达，我们又暂时没办法处理这些网络请求，所以我们先把这些网络请求promise对象存储到队列requests里面，等到刷新好Token之后再依次处理这些promise对象。</span></p><pre data-language="javascript" id="dbN5Q" class="ne-codeblock language-javascript"><code>service.interceptors.response.use(
  res =&gt; {
    //accesstoken超时
    if (res.data.result_status === 30002) {
      //记录当前res
      let response = res;
      if (!isRefreshing) {
        isRefreshing = true;
        return tokenRefreshAPI({
          token: JSON.parse(window.localStorage.token)
        }).then((res) =&gt; {
          //refreshToken没过期，刷新成功
          console.log('tokenRefreshAPI', res.data);
          if (res.data.result_status === 0) {
            console.log('token刷新成功', res.data);
            //重新设置token
            window.localStorage.setItem('token', JSON.stringify(res.data.token));
            //执行失效的函数
            requests.forEach((cb) =&gt; cb());
            requests = []; // 重新请求完清空
            return service(response.config);
          } else if (res.data.result_status === 30011) {
            console.log('refreshToken过期，请重新登录');
            window.localStorage.clear();
            router.push('/login');
          }
        }).finally(() =&gt; {
          isRefreshing = false;
        });
      } else {
        console.log('token过期,剩余请求存入队列', axiosConfig.url);
        // 返回未执行 resolve 的 Promise
        return new Promise(resolve =&gt; {
          // 用函数形式将 resolve 存入，等待刷新后再执行
          requests.push(() =&gt; {
            resolve(service(axiosConfig));
          });
        });
      }
    }
    return res;
  })</code></pre><p id="ub87c58b9" class="ne-p"><span class="ne-text">Token的失效时长设置和前端定时器刷新时长的设置：</span></p><ul class="ne-ul"><li id="u5c2e7c26" data-lake-index-type="0"><span class="ne-text">AccessToken：建议设置为20分钟，以确保即使一次刷新失败，用户仍有足够时间进行重试</span></li><li id="u4a19c199" data-lake-index-type="0"><span class="ne-text">RefreshToken：建议设置为30天，以减少用户频繁重新认证的需求，同时保持适当的安全性</span></li><li id="u61faa424" data-lake-index-type="0"><span class="ne-text">前端刷新：每9分钟刷新一次访问令牌，以确保访问令牌始终有效</span></li></ul><p id="u810ecb5a" class="ne-p"><img src="https://cdn.nlark.com/yuque/0/2024/png/1484158/1720576315951-d114d963-9d65-4fad-ab06-3cff73a63a23.png" width="1639" id="ua67f33bb" class="ne-image"></p><ul class="ne-ul"><li id="u93dd8af7" data-lake-index-type="0"><span class="ne-text">Clientid是必备的</span></li></ul><p id="u67e4fa8e" class="ne-p"><img src="https://cdn.nlark.com/yuque/0/2024/png/1484158/1720576349802-2a999f22-8551-40ae-91dc-6d6d8c8de855.png" width="858" id="u79ad9bec" class="ne-image"></p><ul class="ne-ul"><li id="u89657cbb" data-lake-index-type="0"><span class="ne-text">reponse</span></li></ul><pre data-language="json" id="aFz2y" class="ne-codeblock language-json"><code>{
    &quot;access_token&quot;: &quot;B5483047ABCA442FE7C4B5A45F1EBBCB&quot;,
    &quot;token_type&quot;: &quot;bearer&quot;,
    &quot;refresh_token&quot;: &quot;DFBEC5333D5CA349CB9AC88B895FDAC0&quot;,
    &quot;expires_in&quot;: &quot;71999&quot;,
    &quot;scope&quot;: &quot;all&quot;,
    &quot;member_id&quot;: &quot;45&quot;,
    &quot;user_id&quot;: &quot;1914461805866944000&quot;,
    &quot;group_id&quot;: &quot;g001&quot;,
    &quot;user_name&quot;: &quot;DF001605&quot;,
    &quot;host&quot;: null,
    &quot;hostIp&quot;: null,
    &quot;grayHost&quot;: null,
    &quot;member_name&quot;: &quot;jackyun_dev&quot;,
    &quot;upgradeHost&quot;: null,
    &quot;isGray&quot;: &quot;1&quot;,
    &quot;pdaUpgradeHost&quot;: null,
    &quot;jti&quot;: &quot;edb4d5f7-6b21-4725-8e13-afe0a57796bb&quot;,
    &quot;webSocket&quot;: null,
    &quot;grayWebSocket&quot;: null,
    &quot;company&quot;: &quot;jackyun_dev&quot;,
    &quot;mobile&quot;: &quot;19862171378&quot;,
    &quot;environment&quot;: &quot;dev&quot;,
    &quot;softVersion&quot;: &quot;standard&quot;,
    &quot;authFlag&quot;: null,
    &quot;platCode&quot;: &quot;JACKYUN&quot;,
    &quot;clientId&quot;: &quot;jackyun_web_browser&quot;,
    &quot;risk&quot;: &quot;0&quot;,
    &quot;riskToken&quot;: null,
    &quot;loginDevice&quot;: &quot;web_browser&quot;,
    &quot;fastLoginToken&quot;: null,
    &quot;isBindWeixinMiniProgram&quot;: &quot;0&quot;,
    &quot;realName&quot;: &quot;吴祖涛&quot;,
    &quot;imgUrl&quot;: &quot;&quot;,
    &quot;jdHost&quot;: &quot;&quot;,
    &quot;networkIp&quot;: null,
    &quot;isAdmin&quot;: null,
    &quot;pddHost&quot;: &quot;&quot;,
    &quot;testSwitcher&quot;: null,
    &quot;softwareCode&quot;: null,
    &quot;groupUpgradeInfo&quot;: null,
    &quot;tags&quot;: null,
    &quot;clientSn&quot;: &quot;TC6NROAC-LATW-BROSWER&quot;,
    &quot;roles&quot;: &quot;1&quot;,
    &quot;apiHost&quot;: null,
    &quot;spaceHost&quot;: null,
    &quot;isGreyTestMember&quot;: null,
    &quot;greyTestWebPath&quot;: null,
    &quot;forceChangePassword&quot;: &quot;0&quot;
}</code></pre><p id="ua6618193" class="ne-p"><img src="https://cdn.nlark.com/yuque/0/2024/png/1484158/1720577297935-d5cbdecc-2ff9-4199-a841-550a826a83d8.png" width="1524" id="u0dd41337" class="ne-image" style="color: rgb(65, 65, 65); font-size: 19px"></p><p id="uf68e04bd" class="ne-p"><span class="ne-text">chatgpt info:</span></p><ul class="ne-ul"><li id="u3a6caedf" data-lake-index-type="0"><a href="https://chatgpt.com/share/1a50de0e-f8f8-44dc-a6e2-d3ae0049882a" data-href="https://chatgpt.com/share/1a50de0e-f8f8-44dc-a6e2-d3ae0049882a" target="_blank" class="ne-link"><span class="ne-text">https://chatgpt.com/share/1a50de0e-f8f8-44dc-a6e2-d3ae0049882a</span></a></li></ul></div>0:{"buildId":"2u9SFv74KBoU-OjNq8QW0","rsc":["$","$1","c",{"children":[["$","section",null,{"className":"relative","children":["$","$L2",null,{"fade":true,"blur":true,"transition":{"duration":0.5},"delay":0.1,"className":"relative overflow-hidden border-y xl:flex","children":[["$","div",null,{"className":"m-6 w-full flex-1 bg-[radial-gradient(circle_at_center,color-mix(in_oklab,var(--primary)_15%,transparent)_2px,transparent_2px)] bg-size-[18px_18px] max-xl:hidden"}],["$","div",null,{"className":"mx-auto w-full max-w-6xl flex-none space-y-8 px-4 py-8 min-[1158px]:border-x sm:px-6 sm:py-12 lg:px-8","children":[["$","$L2",null,{"fade":true,"blur":true,"slide":{"direction":"down","offset":30},"transition":{"duration":0.4},"children":["$","$L3",null,{"href":"/blog","className":"text-muted-foreground hover:text-foreground inline-flex items-center gap-2 text-sm transition-colors","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-arrow-left h-4 w-4","aria-hidden":"true","children":[["$","path","1l729n",{"d":"m12 19-7-7 7-7"}],["$","path","x3x0zl",{"d":"M19 12H5"}],"$undefined"]}],"返回","技术博客"]}]}],["$","article",null,{"className":"mx-auto max-w-4xl","children":[["$","header",null,{"className":"mb-8 space-y-6","children":[["$","$L2",null,{"fade":true,"blur":true,"slide":{"direction":"up","offset":50},"delay":0.2,"transition":{"duration":0.6},"children":["$","div",null,{"className":"relative aspect-video overflow-hidden rounded-xl","children":["$","$L4",null,{"src":"https://cdn.nlark.com/yuque/0/2024/png/1484158/1720576315951-d114d963-9d65-4fad-ab06-3cff73a63a23.png","alt":"双token鉴权校验","fill":true,"className":"object-cover","unoptimized":true}]}]}],["$","$L2",null,{"delay":0.3,"transition":{"duration":0.5},"children":["$","h1",null,{"className":"text-2xl font-bold tracking-tight sm:text-3xl md:text-4xl","children":["$","$L5",null,{"text":"双token鉴权校验","delay":30,"animateBy":"words","direction":"bottom"}]}]}],["$","$L2",null,{"fade":true,"blur":true,"slide":{"direction":"down","offset":30},"delay":0.4,"transition":{"duration":0.5},"children":["$","p",null,{"className":"text-muted-foreground text-lg","children":"面试官：说说cookie、session、token、jwt是什么，单点登录怎么实现前端双token校验单token情况下，前端请求后端接口携带Token校验，但是token失效时间如果设置长了会有安全隐患，设置短了用户需要频繁刷新用户体验不好。解决办法：设置两个Token，也就是登录完接口初..."}]}],["$","$L2",null,{"fade":true,"blur":true,"slide":{"direction":"down","offset":30},"delay":0.5,"transition":{"duration":0.5},"children":["$","div",null,{"className":"text-muted-foreground flex flex-wrap items-center gap-4 text-sm","children":[["$","div",null,{"className":"flex items-center gap-1","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-calendar h-4 w-4","aria-hidden":"true","children":[["$","path","1cmpym",{"d":"M8 2v4"}],["$","path","4m81vk",{"d":"M16 2v4"}],["$","rect","1hopcy",{"width":"18","height":"18","x":"3","y":"4","rx":"2"}],["$","path","8toen8",{"d":"M3 10h18"}],"$undefined"]}],["$","span",null,{"children":"2024年4月21日"}]]}],["$","div",null,{"className":"flex items-center gap-1","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-clock h-4 w-4","aria-hidden":"true","children":[["$","path","mmk7yg",{"d":"M12 6v6l4 2"}],["$","circle","1mglay",{"cx":"12","cy":"12","r":"10"}],"$undefined"]}],["$","span",null,{"children":"846字"}]]}],false,false,false]}]}],false]}],["$","$L2",null,{"delay":0.6,"fade":true,"blur":true,"transition":{"duration":0.6},"className":"-mx-4 sm:-mx-6 lg:-mx-8","children":["$","$L6",null,{}]}],["$","$L2",null,{"fade":true,"blur":true,"slide":{"direction":"up","offset":50},"delay":0.7,"transition":{"duration":0.6},"children":["$","div",null,{"className":"prose prose-neutral dark:prose-invert mt-8 max-w-none","dangerouslySetInnerHTML":{"__html":"$7"}}]}],"$L8","$L9"]}]]}],"$La"]}]}],["$Lb"],"$Lc"]}],"loading":null,"isPartial":false}
8:["$","$L2",null,{"delay":0.8,"fade":true,"blur":true,"transition":{"duration":0.6},"className":"-mx-4 mt-12 sm:-mx-6 lg:-mx-8","children":["$","$L6",null,{}]}]
9:["$","$L2",null,{"fade":true,"blur":true,"slide":{"direction":"up","offset":30},"delay":0.9,"transition":{"duration":0.5},"children":["$","nav",null,{"className":"mt-8 grid gap-4 md:grid-cols-2","children":[["$","$L3",null,{"href":"/blog/ew83gy34ryu36u22","className":"hover:bg-muted group flex flex-col rounded-lg border p-4 transition-colors","children":[["$","span",null,{"className":"text-muted-foreground mb-2 text-sm","children":"上一篇"}],["$","span",null,{"className":"group-hover:text-primary line-clamp-2 font-medium transition-colors","children":"whistle抓包"}]]}],["$","$L3",null,{"href":"/blog/2024-04-21-16-20-30","className":"hover:bg-muted group flex flex-col rounded-lg border p-4 text-right transition-colors md:text-right","children":[["$","span",null,{"className":"text-muted-foreground mb-2 text-sm","children":"下一篇"}],["$","span",null,{"className":"group-hover:text-primary line-clamp-2 font-medium transition-colors","children":"前后端实现简单上传功能"}]]}]]}]}]
a:["$","div",null,{"className":"m-6 w-full flex-1 bg-[radial-gradient(circle_at_center,color-mix(in_oklab,var(--primary)_15%,transparent)_2px,transparent_2px)] bg-size-[18px_18px] max-xl:hidden"}]
b:["$","script","script-0",{"src":"/_next/static/chunks/11dff99839ab5ba0.js","async":true}]
c:["$","$Ld",null,{"children":["$","$e",null,{"name":"Next.MetadataOutlet","children":"$@f"}]}]
f:null
